define("question:widget/ask/tag/tag.js",function(t,a,e){var s=t("common:widget/js/util/tangram/tangram.js"),n=t("common:widget/js/ui/base/base.js"),i=t("common:widget/js/ui/dialog/dialog.js"),o=t("question:widget/js/set-tag/set-tag.js"),c=n(function(){}).extend({init:function(){try{var t=this;t.bindEvent()}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"question:widget/ask/tag/tag.js",method:"",ln:17})}},_truncate:function(t,a,e){return t.length>a?t.substr(0,a)+e:t},bindEvent:function(){var t=this;s("#wgt-ask").on("click",".question-tag-change",function(a){try{a.preventDefault();var e=s(this),n=F.context("page"),c=n.title,g=(n.qid,{}),r="question";g.current=[];var d=e.prev().find(".question-tag-link");d.each(function(){g.current.push({name:s(this).text()})}),g.title=c;var l=new o({width:556,height:370,type:r,tags:g,dialogClassName:"question-dialog dialog-set-tag",title:"\u7f16\u8f91\u6807\u7b7e",success:function(){}});s(".question-dialog").on("click",".search-interest",function(t){try{if(t.preventDefault(),""===s(".tag-input input").val())return void s(".tag-input input").css("border-color","#f93535").focus();s(".tag-input input").css("border-color","#5dd04a"),s.ajax({type:"POST",url:"/api/gettag",async:!1,data:{type:1,wd:s(".tag-input input").val()},success:function(t){var a=[];if(t=s.json.parse(t),t.data.length>0){for(var e=0;e<t.data.length;e++)a.push('<a class="tag-item" data-type=""><span>'+t.data[e].tagname+"</span></a>");s(".more-tags-container").empty().append(a.join(""))}else s(".more-tags-container").html('<div class="no-tags-tip">\u6682\u65f6\u6ca1\u6709\u68c0\u7d22\u5230\u6807\u7b7e\uff0c\u8bf7\u60a8\u6362\u4e2a\u5173\u952e\u8bcd\u8bd5\u8bd5\u5427~~</div>');s(".ui-dialog-content").scrollTop(s(".ui-dialog-content").height())}})}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"question:widget/ask/tag/tag.js",method:"",ln:102})}}).on("click",".search-all",function(){try{if(""!==s(".more-tags-container").html())return void s(".more-tags-container").html("");s.ajax({type:"POST",url:"/api/gettagtree",async:!1,data:{},success:function(a){a="object"==typeof a?a:s.json.parse(a),s(".more-tags-container").empty().append('<div class="allTagTop"></div>'),s(".more-tags-container").append('<table class="tags-table"><tr><td class="first-tags"></td><td class="second-tags"></td><td class="third-tags"></td></tr></table>');for(var e=0;e<a.data.length;e++)s(".first-tags").append('<p class="first-tag-name first-tag'+e+'"><span class="tags">'+a.data[e].name+'</span><span class="next"></span></p>'),s(".first-tag"+e).val(a.data[e]);s(".ui-dialog-content").scrollTop(s(".tags-wrap").height()+10),s(".first-tags").on("click",".first-tag-name",function(){try{if(s(this).hasClass("checked"))return;s(".second-tags").empty(),s(".third-tags").empty(),s(".first-tag-name").removeClass("checked"),s(this).addClass("checked");for(var t=s(this).val().child,a=0;a<t.length;a++)s(".second-tags").append('<p class="second-tag-name second-tag'+a+'"><span class="tags">'+t[a].name+'</span><span class="next"></span></p>'),s(".second-tag"+a).val(t[a])}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message,path:"question:widget/ask/tag/tag.js",method:"",ln:140})}}),s(".second-tags").on("click",".second-tag-name",function(){try{if(s(this).hasClass("checked"))return;s(".third-tags").empty(),s(".second-tag-name").removeClass("checked"),s(this).addClass("checked");for(var a=s(this).val().tags,e=0;e<a.length;e++)s(".third-tags").append(e%2===0?'<p class="third-tag-name second-tag'+e+'" style="float: left"><span class="tags">'+t._truncate(a[e],5,"")+"</span></p>":'<p class="third-tag-name second-tag'+e+'" style="float: right"><span class="tags">'+t._truncate(a[e],5,"")+"</span></p>")}catch(n){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message,path:"question:widget/ask/tag/tag.js",method:"",ln:157})}}),s(".third-tags").on("click",".third-tag-name",function(){try{}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"question:widget/ask/tag/tag.js",method:"",ln:174})}})}})}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"question:widget/ask/tag/tag.js",method:"",ln:177})}}).on("click",".cancel",function(){try{l.close()}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"question:widget/ask/tag/tag.js",method:"",ln:180})}}).on("click",".saveTo",function(){try{var t=[],a=[],n=F.context("page").qid;if(s(".currentTag .tag-item").each(function(e,n){var i=s.trim(s(n).text());t.push(i),a.push('<a href="/list?tag='+i+'" target="_blank" class="question-tag-link">'+i+"</a>")}),t=t.join("_"),a=a.join(""),""==t)return void s(".currentTag .tag-tips").html("\u8bf7\u81f3\u5c11\u7ed9\u95ee\u9898\u8bbe\u7f6e\u4e00\u4e2a\u6807\u7b7e").css("color","red");s.ajax({url:"/submit/ajax",type:"POST",dataType:"json",data:{cm:100155,qid:n,content_tag:t},success:function(t){l.close(),0==t.errorNo?e.parent().find(".question-list-item-tag").html(a):i.alert(t.data.info)},error:function(){l.close(),i.alert("\u4fee\u6539\u672a\u6210\u529f\uff0c\u8bf7\u91cd\u8bd5")}})}catch(o){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:o.message,path:"question:widget/ask/tag/tag.js",method:"",ln:238})}}).on("keypress",".tag-input input",function(t){"13"===t.keyCode&&s(".search-interest").trigger("click")})}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"question:widget/ask/tag/tag.js",method:"",ln:243})}})}});e.exports=c});